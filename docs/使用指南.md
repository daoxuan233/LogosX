# 使用指南

## 1. 你会得到什么

运行一次辩论会在 `outputs/` 生成中文 Markdown 文件（默认两份）：

- `辩论_YYYYMMDD_HHMMSS.md`：结构化实录（更利于复盘与规则校验）
- `辩论_YYYYMMDD_HHMMSS_书记员版.md`：书记员整理版（更符合人类阅读习惯）

两份文档都会包含（呈现形式不同）：

- 基本信息（主席/角色/轮次/时间）
- 20+ 轮辩论内容（按轮组织）
- 最终质量评估（逻辑严谨性/哲学深度/文学表达/规则遵守）

## 2. 运行命令

在项目根目录运行；uv 会自动创建/使用虚拟环境并安装依赖：

```bash
uv run debate-arena run --motion "何为善？" --pro-topic "善是一种可教的德性" --opp-topic "善不能被还原为可教之术" --rounds 20
```

可选参数：

- `--motion`：本次议题/总辩题（中文）；也可用兼容参数 `--topic`
- `--pro-topic`：正方议题/立场（中文）。未提供会在启动时询问
- `--opp-topic`：反方议题/立场（中文）。未提供会在启动时询问
- `--west`：指定西方哲学家角色文件名（不含扩展名），例如 `guy_debord`
- `--east`：指定东方哲学家角色文件名（不含扩展名），例如 `zhuangzi`
- `--output`：指定输出 Markdown 文件路径
- `--clerk-output`：指定书记员版输出路径（不填则自动追加 `_书记员版`）
- `--no-clerk`：不生成书记员整理版（默认开启）

示例：

```bash
uv run debate-arena run --motion "自由是否必须以责任为代价？" --pro-topic "自由必以责任为代价" --opp-topic "自由不必以责任为代价" --rounds 20 --west guy_debord --east zhuangzi
```

只生成结构化实录（不生成书记员版）：

```bash
uv run debate-arena run --motion "自由是否必须以责任为代价？" --pro-topic "自由必以责任为代价" --opp-topic "自由不必以责任为代价" --rounds 20 --no-clerk
```

## 2.1 辩论赛制顺序（固定）

系统会严格按以下四个环节编排每一轮的“环节任务”并注入辩手提示词（环节名称完全一致）：开篇立论 → 攻辩/质询 → 自由辩论 → 总结陈词。

轮次分配遵循“轮数体现比重”并做整数化处理（最大余数法），以确保总轮数精确相等：

- 开篇立论：约 21%
- 攻辩/质询：约 16%
- 自由辩论：约 36%
- 总结陈词：约 27%（反方先总结、正方最后发言）

示例：总轮次 20 轮时，将分配为 4 / 3 / 7 / 6 轮。

## 3. 角色与提示词配置

角色文件位于：

- 西方：config/philosopher_roles/west/
- 东方：config/philosopher_roles/east/

每个 YAML 主要字段：

- `role_name`：哲学家名称
- `core_philosophy`：核心思想（用于提示词注入）
- `classic_works`：可引用的经典著作候选
- `story_templates`：偏好故事开头/叙事语境
- `forbidden_topics`：禁区（例如“直接政治批判”等）

你可以复制已有样例（例如 `guy_debord.yaml` / `zhuangzi.yaml`）新增更多哲学家。

## 4. 书记员 Agent 配置

书记员规则位于 `config/clerk_rules.yaml`，核心目的不是改写辩论内容，而是把每轮“结构化字段”重新编排为更自然的对话与叙事文本。

书记员严格边界：

- ✅ 允许：文学润色、段落重构、修辞优化、少量神态/动作描写
- ❌ 禁止：改变立场/论点、增删论据、调整逻辑链条、跨轮引用

为降低 LLM 漏段风险，书记员带有“保真覆盖校验 + 自动补救重写”，若检测到原文片段未覆盖，会发起一次补救重写请求。

## 4. 敏感内容策略

敏感词配置位于 `config/sensitive_keywords.yaml`。
一旦触发：

- 辩手必须使用故事隐喻表达论点
- 避免直接点名敏感对象或事件
- 仍需在“故事寓意”中给出清晰映射

## 5. 常见问题

### Q：为什么提示缺少依赖？

本项目依赖通过 uv 安装。请先完成依赖安装，再运行。
依赖包括：langchain/langgraph、python-dotenv、redis、sentence-transformers 等。

### Q：SearXNG / Redis 没开会怎样？

搜索层会自动降级：
- Redis 不可用：退化为 SQLite 或直接实时搜索
- SearXNG 不可用：搜索结果为空，但辩论仍可继续（文档中仍会输出结构化内容）

### Q：为什么我用系统 Python 运行会报 typing 相关错误？

请优先使用 `uv run ...` 运行，以确保使用项目的 Python 3.11+ 与依赖环境。直接用系统 Python（例如较旧的 Anaconda 环境）可能导致类型相关兼容问题。
